/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*
  Copyright (C) 2013 Gregory Schier <gschier1990@gmail.com>
  Copyright (C) 2013 Martin Zimmermann <info@posativ.org>

  Inspired by http://codepen.io/gschier/pen/GLvAy
*/

/*
 * Copyright 2014, Martin Zimmermann <info@posativ.org>. All rights reserved.
 * Distributed under the MIT license
 */

(function(){var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.slice(0,v.length-1).concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){var i=l.call(arguments,0);return typeof i[0]!="string"&&i.length===1&&i.push(null),n.apply(e,i.concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){if(typeof e!="string")throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("components/almond/almond",function(){}),define("app/lib/ready",[],function(){"use strict";var e=!1,t=function(t){e||(e=!0,t())},n=function(e){document.addEventListener("DOMContentLoaded",function(){t(e)}),(document.readyState==="interactive"||document.readyState==="complete")&&t(e)};return n}),define("app/config",[],function(){"use strict";var e={css:!0,lang:(navigator.language||navigator.userLanguage).split("-")[0],"reply-to-self":!1,"require-email":!1,"max-comments-top":"inf","max-comments-nested":5,"reveal-on-click":5,avatar:!0,"avatar-bg":"#f0f0f0","avatar-fg":["#9abf88","#5698c4","#e279a3","#9163b6","#be5168","#f19670","#e4bf80","#447c69"].join(" "),vote:!0,"nesting-level":1},t=document.getElementsByTagName("script");for(var n=0;n<t.length;n++)for(var r=0;r<t[n].attributes.length;r++){var i=t[n].attributes[r];if(/^data-isso-/.test(i.name))try{e[i.name.substring(10)]=JSON.parse(i.value)}catch(s){e[i.name.substring(10)]=i.value}}return e["avatar-fg"]=e["avatar-fg"].split(" "),e}),define("app/i18n/de",{"postbox-text":"Kommentar hier eintippen (mindestens 3 Zeichen)","postbox-author":"Name (optional)","postbox-email":"Email (optional)","postbox-website":"Website (optional)","postbox-submit":"Abschicken","num-comments":"1 Kommentar\n{{ n }} Kommentare","no-comments":"Keine Kommentare bis jetzt","comment-reply":"Antworten","comment-edit":"Bearbeiten","comment-save":"Speichern","comment-delete":"Löschen","comment-confirm":"Bestätigen","comment-close":"Schließen","comment-cancel":"Abbrechen","comment-deleted":"Kommentar gelöscht.","comment-queued":"Kommentar muss noch freigeschaltet werden.","comment-anonymous":"Anonym","comment-hidden":"{{ n }} versteckt","date-now":"eben jetzt","date-minute":"vor einer Minute\nvor {{ n }} Minuten","date-hour":"vor einer Stunde\nvor {{ n }} Stunden","date-day":"Gestern\nvor {{ n }} Tagen","date-week":"letzte Woche\nvor {{ n }} Wochen","date-month":"letzten Monat\nvor {{ n }} Monaten","date-year":"letztes Jahr\nvor {{ n }} Jahren"}),define("app/i18n/en",{"postbox-text":"Type Comment Here (at least 3 chars)","postbox-author":"Name (optional)","postbox-email":"E-mail (optional)","postbox-website":"Website (optional)","postbox-submit":"Submit","num-comments":"One Comment\n{{ n }} Comments","no-comments":"No Comments Yet","comment-reply":"Reply","comment-edit":"Edit","comment-save":"Save","comment-delete":"Delete","comment-confirm":"Confirm","comment-close":"Close","comment-cancel":"Cancel","comment-deleted":"Comment deleted.","comment-queued":"Comment in queue for moderation.","comment-anonymous":"Anonymous","comment-hidden":"{{ n }} Hidden","date-now":"right now","date-minute":"a minute ago\n{{ n }} minutes ago","date-hour":"an hour ago\n{{ n }} hours ago","date-day":"Yesterday\n{{ n }} days ago","date-week":"last week\n{{ n }} weeks ago","date-month":"last month\n{{ n }} months ago","date-year":"last year\n{{ n }} years ago"}),define("app/i18n/fr",{"postbox-text":"Insérez votre commentaire ici (au moins 3 lettres)","postbox-author":"Nom (optionnel)","postbox-email":"Courriel (optionnel)","postbox-website":"Site web (optionnel)","postbox-submit":"Soumettre","num-comments":"{{ n }} commentaire\n{{ n }} commentaires","no-comments":"Aucun commentaire pour l'instant","comment-reply":"Répondre","comment-edit":"Éditer","comment-save":"Enregistrer","comment-delete":"Supprimer","comment-confirm":"Confirmer","comment-close":"Fermer","comment-cancel":"Annuler","comment-deleted":"Commentaire supprimé.","comment-queued":"Commentaire en attente de modération.","comment-anonymous":"Anonyme","comment-hidden":"1 caché\n{{ n }} cachés","date-now":"À l'instant","date-minute":"Il y a une minute\nIl y a {{ n }} minutes","date-hour":"Il y a une heure\nIl y a {{ n }} heures ","date-day":"Hier\nIl y a {{ n }} jours","date-week":"Il y a une semaine\nIl y a {{ n }} semaines","date-month":"Il y a un mois\nIl y a {{ n }} mois","date-year":"Il y a un an\nIl y a {{ n }} ans"}),define("app/i18n/ru",{"postbox-text":"Оставить комментарий (минимум 3 символа)","postbox-author":"Имя (необязательно)","postbox-email":"Email (необязательно)","postbox-website":"Сайт (необязательно)","postbox-submit":"Отправить","num-comments":"1 комментарий\n{{ n }} комментария\n{{ n }} комментариев","no-comments":"Оставить комментарий","comment-reply":"Ответить","comment-edit":"Правка","comment-save":"Сохранить","comment-delete":"Удалить","comment-confirm":"Подтвердить удаление","comment-close":"Закрыть","comment-cancel":"Отменить","comment-deleted":"Комментарий удалён","comment-queued":"Комментарий будет проверен модератором","comment-anonymous":"Аноним","comment-hidden":"Показать ещё 1 комментарий\nПоказать ещё {{ n }} комментария\nПоказать ещё {{ n }} комментариев","date-now":"Только что","date-minute":"{{ n }} минуту назад\n{{ n }} минуты назад\n{{ n }} минут назад","date-hour":"{{ n }} час назад\n{{ n }} часа назад\n{{ n }} часов назад","date-day":"{{ n }} день назад\n{{ n }} дня назад\n{{ n }} дней назад","date-week":"{{ n }} неделю назад\n{{ n }} недели назад\n{{ n }} недель назад","date-month":"{{ n }} месяц назад\n{{ n }} месяца назад\n{{ n }} месяцев назад","date-year":"{{ n }} год назад\n{{ n }} года назад\n{{ n }} лет назад"}),define("app/i18n/it",{"postbox-text":"Scrivi un commento qui (minimo 3 caratteri)","postbox-author":"Nome (opzionale)","postbox-email":"E-mail (opzionale)","postbox-website":"Sito web (opzionale)","postbox-submit":"Invia","num-comments":"Un Commento\n{{ n }} Commenti","no-comments":"Ancora Nessun Commento","comment-reply":"Rispondi","comment-edit":"Modifica","comment-save":"Salva","comment-delete":"Elimina","comment-confirm":"Conferma","comment-close":"Chiudi","comment-cancel":"Cancella","comment-deleted":"Commento eliminato.","comment-queued":"Commento in coda per moderazione.","comment-anonymous":"Anonimo","comment-hidden":"{{ n }} Nascosto","date-now":"poco fa","date-minute":"un minuto fa\n{{ n }} minuti fa","date-hour":"un ora fa\n{{ n }} ore fa","date-day":"Ieri\n{{ n }} giorni fa","date-week":"questa settimana\n{{ n }} settimane fa","date-month":"questo mese\n{{ n }} mesi fa","date-year":"quest'anno\n{{ n }} anni fa"}),define("app/i18n/eo",{"postbox-text":"Tajpu komenton ĉi-tie (almenaŭ 3 signoj)","postbox-author":"Nomo (malnepra)","postbox-email":"Retadreso (malnepra)","postbox-website":"Retejo (malnepra)","postbox-submit":"Sendu","num-comments":"{{ n }} komento\n{{ n }} komentoj","no-comments":"Neniu komento ankoraŭ","comment-reply":"Respondu","comment-edit":"Redaktu","comment-save":"Savu","comment-delete":"Forviŝu","comment-confirm":"Konfirmu","comment-close":"Fermu","comment-cancel":"Malfaru","comment-deleted":"Komento forviŝita","comment-queued":"Komento en atendovico por kontrolo.","comment-anonymous":"Sennoma","comment-hidden":"{{ n }} kaŝitaj","date-now":"ĵus nun","date-minute":"antaŭ unu minuto\nantaŭ {{ n }} minutoj","date-hour":"antaŭ unu horo\nantaŭ {{ n }} horoj","date-day":"hieraŭ\nantaŭ {{ n }} tagoj","date-week":"lasta semajno\nantaŭ {{ n }} semajnoj","date-month":"lasta monato\nantaŭ {{ n }} monatoj","date-year":"lasta jaro\nantaŭ {{ n }} jaroj"}),define("app/i18n/sv",{"postbox-text":"Skriv din kommentar här (minst 3 tecken)","postbox-author":"Namn (frivilligt)","postbox-email":"E-mail (frivilligt)","postbox-website":"Hemsida (frivilligt)","postbox-submit":"Skicka","num-comments":"En kommentar\n{{ n }} kommentarer","no-comments":"Inga kommentarer än","comment-reply":"Svara","comment-edit":"Redigera","comment-save":"Spara","comment-delete":"Radera","comment-confirm":"Bekräfta","comment-close":"Stäng","comment-cancel":"Avbryt","comment-deleted":"Kommentar raderad.","comment-queued":"Kommentaren inväntar granskning.","comment-anonymous":"Anonym","comment-hidden":"{{ n }} Gömd","date-now":"just nu","date-minute":"en minut sedan\n{{ n }} minuter sedan","date-hour":"en timme sedan\n{{ n }} timmar sedan","date-day":"igår\n{{ n }} dagar sedan","date-week":"förra veckan\n{{ n }} veckor sedan","date-month":"förra månaden\n{{ n }} månader sedan","date-year":"förra året\n{{ n }} år sedan"}),define("app/i18n/nl",{"postbox-text":"Typ reactie hier (minstens 3 karakters)","postbox-author":"Naam (optioneel)","postbox-email":"E-mail (optioneel)","postbox-website":"Website (optioneel)","postbox-submit":"Versturen","num-comments":"Één reactie\n{{ n }} reacties","no-comments":"Nog geen reacties","comment-reply":"Beantwoorden","comment-edit":"Bewerken","comment-save":"Opslaan","comment-delete":"Verwijderen","comment-confirm":"Bevestigen","comment-close":"Sluiten","comment-cancel":"Annuleren","comment-deleted":"Reactie verwijderd.","comment-queued":"Reactie staat in de wachtrij voor goedkeuring.","comment-anonymous":"Anoniem","comment-hidden":"{{ n }} verborgen","date-now":"zojuist","date-minute":"een minuut geleden\n{{ n }} minuten geleden","date-hour":"een uur geleden\n{{ n }} uur geleden","date-day":"gisteren\n{{ n }} dagen geleden","date-week":"vorige week\n{{ n }} weken geleden","date-month":"vorige maand\n{{ n }} maanden geleden","date-year":"vorig jaar\n{{ n }} jaar geleden"}),define("app/i18n/el_GR",{"postbox-text":"Γράψτε το σχόλιο εδώ (τουλάχιστον 3 χαρακτήρες)","postbox-author":"Όνομα (προαιρετικό)","postbox-email":"E-mail (προαιρετικό)","postbox-website":"Ιστοσελίδα (προαιρετικό)","postbox-submit":"Υποβολή","num-comments":"Ένα σχόλιο\n{{ n }} σχόλια","no-comments":"Δεν υπάρχουν σχόλια","comment-reply":"Απάντηση","comment-edit":"Επεξεργασία","comment-save":"Αποθήκευση","comment-delete":"Διαγραφή","comment-confirm":"Επιβεβαίωση","comment-close":"Κλείσιμο","comment-cancel":"Ακύρωση","comment-deleted":"Διαγραμμένο σχόλιο ","comment-queued":"Το σχόλιο αναμένει έγκριση","comment-anonymous":"Ανώνυμος","comment-hidden":"{{ n }} Κρυμμένα","date-now":"τώρα","date-minute":"πριν ένα λεπτό\nπριν {{ n }} λεπτά","date-hour":"πριν μία ώρα\nπριν {{ n }} ώρες","date-day":"Χτες\nπριν {{ n }} μέρες","date-week":"την προηγούμενη εβδομάδα\nπριν {{ n }} εβδομάδες","date-month":"τον προηγούμενο μήνα\nπριν {{ n }} μήνες","date-year":"πέρυσι\nπριν {{ n }} χρόνια"}),define("app/i18n/es",{"postbox-text":"Escriba su comentario aquí (al menos 3 caracteres)","postbox-author":"Nombre (opcional)","postbox-email":"E-mail (opcional)","postbox-website":"Sitio web (opcional)","postbox-submit":"Enviar","num-comments":"Un Comentario\n{{ n }} Comentarios","no-comments":"Sin Comentarios Todavía","comment-reply":"Responder","comment-edit":"Editar","comment-save":"Guardar","comment-delete":"Eliminar","comment-confirm":"Confirmar","comment-close":"Cerrar","comment-cancel":"Cancelar","comment-deleted":"Comentario eliminado.","comment-queued":"Comentario en espera para moderación.","comment-anonymous":"Anónimo","comment-hidden":"{{ n }} Oculto(s)","date-now":"ahora","date-minute":"hace un minuto\nhace {{ n }} minutos","date-hour":"hace una hora\nhace {{ n }} horas","date-day":"ayer\nHace {{ n }} días","date-week":"la semana pasada\nhace {{ n }} semanas","date-month":"el mes pasado\nhace {{ n }} meses","date-year":"el año pasado\nhace {{ n }} años"}),define("app/i18n/zh_CN",{"postbox-text":"在此输入评论(最少3个字符)","postbox-author":"名字(可选)","postbox-email":"E-mail(可选)","postbox-website":"网站(可选)","postbox-submit":"提交","num-comments":"1条评论\n{{ n }}条评论","no-comments":"还没有评论","comment-reply":"回复","comment-edit":"编辑","comment-save":"保存","comment-delete":"删除","comment-confirm":"确认","comment-close":"关闭","comment-cancel":"取消","comment-deleted":"评论已删除.","comment-queued":"评论待审核.","comment-anonymous":"匿名","comment-hidden":"{{ n }} 条评论已隐藏","date-now":"刚刚","date-minute":"1分钟前\n{{ n }}分钟前","date-hour":"1小时前\n{{ n }}小时前","date-day":"昨天\n{{ n }}天前","date-week":"上周\n{{ n }}周前","date-month":"上个月\n{{ n }}个月前","date-year":"去年\n{{ n }}年前"}),define("app/i18n",["app/config","app/i18n/de","app/i18n/en","app/i18n/fr","app/i18n/ru","app/i18n/it","app/i18n/eo","app/i18n/sv","app/i18n/nl","app/i18n/el_GR","app/i18n/es","app/i18n/zh_CN"],function(e,t,n,r,i,s,o,u,a,f,l,c){"use strict";var h=function(e){switch(e){case"de":case"el":case"en":case"es":case"eo":case"it":case"sv":case"nl":case"zh":return function(e,t){return e[t===1?0:1]};case"fr":return function(e,t){return e[t>1?1:0]};case"ru":return function(e,t){return t%10===1&&t%100!==11?e[0]:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?e[1]:typeof e[2]!="undefined"?e[2]:e[1]};default:return null}},p=e.lang;h(p)||(p="en");var d={de:t,el:f,en:n,eo:o,fr:r,it:s,ru:i,sv:u,nl:a,zh:c,es:l},v=h(p),m=function(e){return d[p][e]||n[e]||"???"},g=function(e,t){var n;return n=m(e),n.indexOf("\n")>-1&&(n=v(n.split("\n"),+t)),n?n.replace("{{ n }}",+t):n};return{lang:p,translate:m,pluralize:g}}),define("app/lib/promise",[],function(){"use strict";var e=function(e){console.log(e)},t=function(){this.success=[],this.errors=[]};t.prototype.then=function(t,n){this.success.push(t),n?this.errors.push(n):this.errors.push(e)};var n=function(){this.promise=new t};n.prototype={promise:t,resolve:function(e){this.promise.success.forEach(function(t){window.setTimeout(function(){t(e)},0)})},reject:function(e){this.promise.errors.forEach(function(t){window.setTimeout(function(){t(e)},0)})}};var r=function(e,n){return e instanceof t?e.then(n):n(e)};return{defer:function(){return new n},when:r}}),define("app/globals",[],function(){"use strict";var e=function(){this.values=[]};return e.prototype.update=function(e){this.values.push((new Date).getTime()-e.getTime())},e.prototype.localTime=function(){return this.values.length?new Date((new Date).getTime()+this.values.reduce(function(e,t){return e+t})/this.values.length):new Date},{offset:new e}}),define("app/api",["app/lib/promise","app/globals"],function(e,t){"use strict";var n="Eech7co8Ohloopo9Ol6baimi",r=window.location.pathname,i,s,o=document.getElementsByTagName("script");for(var u=0;u<o.length;u++)if(o[u].hasAttribute("data-isso")){s=o[u].getAttribute("data-isso");break}if(!s){for(u=0;u<o.length;u++)if(o[u].getAttribute("async")||o[u].getAttribute("defer"))throw"Isso's automatic configuration detection failed, please refer to https://github.com/posativ/isso#client-configuration and add a custom `data-isso` attribute.";i=o[o.length-1],s=i.src.substring(0,i.src.length-"/js/embed.min.js".length)}s[s.length-1]==="/"&&(s=s.substring(0,s.length-1));var a=function(e,n,r,i,s){function u(){var e=o.getResponseHeader("Date");e!==null&&t.offset.update(new Date(e));var n=o.getResponseHeader("X-CSRF-Token");n!==null&&(t.csrf_token=n);var r=o.getResponseHeader("X-Set-Cookie");r&&r.match(/^isso-/)&&(document.cookie=r),o.status>=500?s&&s(o.body):i({status:o.status,body:o.responseText})}var o=new XMLHttpRequest;try{o.open(e,n,!0),o.withCredentials=!0,o.setRequestHeader("Content-Type","application/json"),"csrf_token"in t&&o.setRequestHeader("X-CSRF-Token",t.csrf_token),o.onreadystatechange=function(){o.readyState===4&&u()}}catch(a){(s||console.log)(a.message)}o.send(r)},f=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&e[n]!==null&&typeof e[n]!="undefined"&&(t+=n+"="+encodeURIComponent(e[n])+"&");return t.substring(0,t.length-1)},l=function(t,n){var i=e.defer();return a("POST",s+"/new?"+f({uri:t||r}),JSON.stringify(n),function(e){e.status===201||e.status===202?i.resolve(JSON.parse(e.body)):i.reject(e.body)}),i.promise},c=function(t,n){var r=e.defer();return a("PUT",s+"/id/"+t,JSON.stringify(n),function(e){e.status===403?r.reject("Not authorized to modify this comment!"):e.status===200?r.resolve(JSON.parse(e.body)):r.reject(e.body)}),r.promise},h=function(t){var n=e.defer();return a("DELETE",s+"/id/"+t,null,function(e){e.status===403?n.reject("Not authorized to remove this comment!"):e.status===200?n.resolve(JSON.parse(e.body)===null):n.reject(e.body)}),n.promise},p=function(t,n){var r=e.defer();return a("GET",s+"/id/"+t+"?"+f({plain:n}),null,function(e){r.resolve(JSON.parse(e.body))}),r.promise},d=function(t,n,i,o,u){typeof n=="undefined"&&(n="inf"),typeof i=="undefined"&&(i="inf"),typeof o=="undefined"&&(o=null);var l={uri:t||r,after:u,parent:o};n!=="inf"&&(l.limit=n),i!=="inf"&&(l.nested_limit=i);var c=e.defer();return a("GET",s+"/?"+f(l),null,function(e){e.status===200?c.resolve(JSON.parse(e.body)):e.status===404?c.resolve({total_replies:0}):c.reject(e.body)}),c.promise},v=function(t){var n=e.defer();return a("POST",s+"/count",JSON.stringify(t),function(e){e.status===200?n.resolve(JSON.parse(e.body)):n.reject(e.body)}),n.promise},m=function(t){var n=e.defer();return a("POST",s+"/id/"+t+"/like",null,function(e){n.resolve(JSON.parse(e.body))}),n.promise},g=function(t){var n=e.defer();return a("POST",s+"/id/"+t+"/dislike",null,function(e){n.resolve(JSON.parse(e.body))}),n.promise};return{endpoint:s,salt:n,create:l,modify:c,remove:h,view:p,fetch:d,count:v,like:m,dislike:g}}),define("app/dom",[],function(){"use strict";window.Element.prototype.replace=function(t){var n=e.htmlify(t);return this.parentNode.replaceChild(n,this),n},window.Element.prototype.prepend=function(t){var n=e.htmlify(t);return this.insertBefore(n,this.firstChild),n},window.Element.prototype.append=function(t){var n=e.htmlify(t);return this.appendChild(n),n},window.Element.prototype.insertAfter=function(t){var n=e.htmlify(t);return this.parentNode.insertBefore(n,this.nextSibling),n},window.Element.prototype.on=function(e,t,n){this.addEventListener(e,function(e){t(e),(n===undefined||n)&&e.preventDefault()})},window.Element.prototype.toggle=function(e,t,n){function r(e,t,n){this.state=!1,this.el=e,this.a=t,this.b=n}r.prototype.next=function(){this.state?(this.state=!1,this.b(this)):(this.state=!0,this.a(this))},r.prototype.wait=function(){this.state=!this.state};var i=new r(this,t,n);this.on(e,function(){i.next()})},window.Element.prototype.detach=function(){return this.parentNode.removeChild(this),this},window.Element.prototype.remove=function(){this.parentNode.removeChild(this)},window.Element.prototype.show=function(){this.style.display="block"},window.Element.prototype.hide=function(){this.style.display="none"};var e=function(e,t,n){typeof n=="undefined"&&(n=!0),t||(t=window.document);var r=t.querySelectorAll(e);return r.length===0?null:r.length===1&&n?r[0]:r};return e.htmlify=function(t){if(t instanceof window.Element)return t;var n=e.new("div");return n.innerHTML=t,n.firstChild},e.new=function(e,t){var n=document.createElement(e.split(".")[0]);return e.split(".").slice(1).forEach(function(e){n.classList.add(e)}),["A","LINK"].indexOf(n.nodeName)>-1&&(n.href="#"),["TEXTAREA","INPUT"].indexOf(n.nodeName)>-1?n.value=t||"":n.textContent=t||"",n},e.each=function(e,t){Array.prototype.forEach.call(document.getElementsByTagName(e),t)},e}),define("app/utils",["app/i18n"],function(e){"use strict";var t=function(e){return(document.cookie.match("(^|; )"+e+"=([^;]*)")||0)[2]},n=function(e,t,n){return n=n||"0",e+="",e.length>=t?e:(new Array(t-e.length+1)).join(n)+e},r=function(t,n){var r=(t.getTime()-n.getTime())/1e3;if(isNaN(r)||r<0)r=0;var i=Math.ceil(r/60),s=Math.ceil(i/60),o=Math.ceil(s/24);return r<=45&&e.translate("date-now")||r<=90&&e.pluralize("date-minute",1)||i<=45&&e.pluralize("date-minute",i)||i<=90&&e.pluralize("date-hour",1)||s<=22&&e.pluralize("date-hour",s)||s<=36&&e.pluralize("date-day",1)||o<=5&&e.pluralize("date-day",o)||o<=8&&e.pluralize("date-week",1)||o<=21&&e.pluralize("date-week",Math.ceil(o/7))||o<=45&&e.pluralize("date-month",1)||o<=345&&e.pluralize("date-month",Math.ceil(o/30))||o<=547&&e.pluralize("date-year",1)||e.pluralize("date-year",Math.ceil(o/365.25))},i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},s=function(e){return String(e).replace(/[&<>"'\/]/g,function(e){return i[e]})},o=function(e){var t=document.createElement("div");return t.innerHTML=e.replace(/<div><br><\/div>/gi,"<br>").replace(/<div>/gi,"<br>").replace(/<br>/gi,"\n").replace(/&nbsp;/gi," "),t.textContent.trim()},u=function(e){return e=s(e),e.replace(/\n\n/gi,"<br><div><br></div>").replace(/\n/gi,"<br>")},a;try{localStorage.setItem("x","y"),localStorage.removeItem("x"),a=localStorage}catch(f){a=function(e){return{setItem:function(t,n){e[t]=n},getItem:function(t){return typeof e[t]!="undefined"?e[t]:null},removeItem:function(t){delete e[t]}}}({})}return{cookie:t,pad:n,ago:r,text:o,detext:u,localStorageImpl:a}}),function(e){if(typeof exports=="object"&&typeof module!="undefined")module.exports=e();else if(typeof define=="function"&&define.amd)define("libjs-jade-runtime",[],e);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"?t=self:t=this,t.jade=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){"use strict";function r(e){return e!=null&&e!==""}function i(e){return(Array.isArray(e)?e.map(i):e&&typeof e=="object"?Object.keys(e).filter(function(t){return e[t]}):[e]).filter(r).join(" ")}function u(e){return s[e]||e}function a(e){var t=String(e).replace(o,u);return t===""+e?e:t}n.merge=function f(e,t){if(arguments.length===1){var n=e[0];for(var i=1;i<e.length;i++)n=f(n,e[i]);return n}var s=e["class"],o=t["class"];if(s||o)s=s||[],o=o||[],Array.isArray(s)||(s=[s]),Array.isArray(o)||(o=[o]),e["class"]=s.concat(o).filter(r);for(var u in t)u!="class"&&(e[u]=t[u]);return e},n.joinClasses=i,n.cls=function(t,r){var s=[];for(var o=0;o<t.length;o++)r&&r[o]?s.push(n.escape(i([t[o]]))):s.push(i(t[o]));var u=i(s);return u.length?' class="'+u+'"':""},n.style=function(e){return e&&typeof e=="object"?Object.keys(e).map(function(t){return t+":"+e[t]}).join(";"):e},n.attr=function(t,r,i,s){return t==="style"&&(r=n.style(r)),"boolean"==typeof r||null==r?r?" "+(s?t:t+'="'+t+'"'):"":0==t.indexOf("data")&&"string"!=typeof r?(JSON.stringify(r).indexOf("&")!==-1&&console.warn("Since Jade 2.0.0, ampersands (`&`) in data attributes will be escaped to `&amp;`"),r&&typeof r.toISOString=="function"&&console.warn("Jade will eliminate the double quotes around dates in ISO form after 2.0.0")," "+t+"='"+JSON.stringify(r).replace(/'/g,"&apos;")+"'"):i?(r&&typeof r.toISOString=="function"&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+t+'="'+n.escape(r)+'"'):(r&&typeof r.toISOString=="function"&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+t+'="'+r+'"')},n.attrs=function(t,r){var s=[],o=Object.keys(t);if(o.length)for(var u=0;u<o.length;++u){var a=o[u],f=t[a];"class"==a?(f=i(f))&&s.push(" "+a+'="'+f+'"'):s.push(n.attr(a,f,!1,r))}return s.join("")};var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},o=/[&<>"]/g;n.escape=a,n.rethrow=function l(t,n,r,i){if(t instanceof Error){if((typeof window!="undefined"||!n)&&!i)throw t.message+=" on line "+r,t;try{i=i||e("fs").readFileSync(n,"utf8")}catch(s){l(t,null,r)}var o=3,u=i.split("\n"),a=Math.max(r-o,0),f=Math.min(u.length,r+o),o=u.slice(a,f).map(function(e,t){var n=t+a+1;return(n==r?"  > ":"    ")+n+"| "+e}).join("\n");throw t.path=n,t.message=(n||"Jade")+":"+r+"\n"+o+"\n\n"+t.message,t}throw t},n.DebugItem=function(t,n){this.lineno=t,this.filename=n}},{fs:2}],2:[function(e,t,n){},{}]},{},[1])(1)}),define("jade",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("jade!app/text/postbox",function(){var e=function(t){var n=[],r={},i,s=t||{};return function(e,t,r,s){n.push('<div class="isso-postbox"><div class="form-wrapper"><div class="textarea-wrapper"><div contenteditable="true" class="textarea placeholder">'+jade.escape(null==(i=r("postbox-text"))?"":i)+'</div></div><section class="auth-section"><p class="input-wrapper"><input type="text" name="author"'+jade.attr("placeholder",r("postbox-author"),!0,!1)+jade.attr("value",e!==null?""+e+"":"",!0,!1)+'/></p><p class="input-wrapper"><input type="email" name="email"'+jade.attr("placeholder",r("postbox-email"),!0,!1)+jade.attr("value",t!=null?""+t+"":"",!0,!1)+'/></p><p class="input-wrapper"><input type="text" name="website"'+jade.attr("placeholder",r("postbox-website"),!0,!1)+jade.attr("value",s!=null?""+s+"":"",!0,!1)+'/></p><p class="post-action"><input type="submit"'+jade.attr("value",r("postbox-submit"),!0,!1)+"/></p></section></div></div>")}.call(this,"author"in s?s.author:typeof author!="undefined"?author:undefined,"email"in s?s.email:typeof email!="undefined"?email:undefined,"i18n"in s?s.i18n:typeof i18n!="undefined"?i18n:undefined,"website"in s?s.website:typeof website!="undefined"?website:undefined),n.join("")};return e}),define("jade!app/text/comment",function(){var e=function(t){var n=[],r={},i,s=t||{};return function(e,t,r,s,o,u,a){n.push("<div"+jade.attr("id","isso-"+t.id+"",!0,!1)+' class="isso-comment">'),r.avatar&&n.push('<div class="avatar"><svg'+jade.attr("data-hash",""+t.hash+"",!0,!1)+"></svg></div>"),n.push('<div class="text-wrapper"><div role="meta" class="isso-comment-header">'),e(t.website)?n.push("<a"+jade.attr("href",""+t.website+"",!0,!1)+' rel="nofollow" class="author">'+jade.escape(null==(i=e(t.author)?t.author:u("comment-anonymous"))?"":i)+"</a>"):n.push('<span class="author">'+jade.escape(null==(i=e(t.author)?t.author:u("comment-anonymous"))?"":i)+"</span>"),n.push('<span class="spacer">&bull;</span><a'+jade.attr("href","#isso-"+t.id+"",!0,!1)+' class="permalink"><time'+jade.attr("title",""+o(t.created)+"",!0,!1)+jade.attr("datetime",""+s(t.created)+"",!0,!1)+'></time></a><span class="note">'+jade.escape(null==(i=t.mode==2?u("comment-queued"):t.mode==4?u("comment-deleted"):"")?"":i)+'</span></div><div class="text">'),t.mode==4?n.push("<p>&nbsp;</p>"):n.push(null==(i=t.text)?"":i),n.push("</div>");var f=!r.locked||r.vote;f&&(n.push('<div class="isso-comment-footer">'),r.vote&&(t.likes-t.dislikes!=0&&n.push('<span class="votes">'+jade.escape((i=t.likes-t.dislikes)==null?"":i)+"</span>"),n.push('<a href="#" class="upvote">'+(null==(i=a["arrow-up"])?"":i)+'</a><span class="spacer">|</span><a href="#" class="downvote">'+(null==(i=a["arrow-down"])?"":i)+"</a>")),r.locked||(r["nesting-level"]>=1&&n.push('<a href="#" class="reply">'+jade.escape((i=u("comment-reply"))==null?"":i)+"</a>"),n.push('<a href="#" class="edit">'+jade.escape((i=u("comment-edit"))==null?"":i)+'</a><a href="#" class="delete">'+jade.escape((i=u("comment-delete"))==null?"":i)+"</a>")),n.push("</div>")),n.push('<div class="isso-follow-up"></div></div></div>')}.call(this,"bool"in s?s.bool:typeof bool!="undefined"?bool:undefined,"comment"in s?s.comment:typeof comment!="undefined"?comment:undefined,"conf"in s?s.conf:typeof conf!="undefined"?conf:undefined,"datetime"in s?s.datetime:typeof datetime!="undefined"?datetime:undefined,"humanize"in s?s.humanize:typeof humanize!="undefined"?humanize:undefined,"i18n"in s?s.i18n:typeof i18n!="undefined"?i18n:undefined,"svg"in s?s.svg:typeof svg!="undefined"?svg:undefined),n.join("")};return e}),define("jade!app/text/comment-loader",function(){var e=function(t){var n=[],r={},i,s=t||{};return function(e,t){n.push("<div"+jade.attr("id","isso-loader-"+e.name+"",!0,!1)+' class="isso-comment-loader"><a href="#" class="load_hidden">↓ load more comments ('+jade.escape((i=t("comment-hidden",e.hidden_replies))==null?"":i)+")</a></div>")}.call(this,"comment"in s?s.comment:typeof comment!="undefined"?comment:undefined,"pluralize"in s?s.pluralize:typeof pluralize!="undefined"?pluralize:undefined),n.join("")};return e}),define("jade!app/text/continue-thread",function(){var e=function(t){var n=[],r={},i,s=t||{};return function(e,t){n.push("<div"+jade.attr("id","isso-continue-thread-"+e.name+"",!0,!1)+' class="isso-continue-thread"><a href="#" class="continue-thread">↪ continue this thread ('+jade.escape((i=t("comment-hidden",e.deeper_replies))==null?"":i)+")</a></div>")}.call(this,"comment"in s?s.comment:typeof comment!="undefined"?comment:undefined,"pluralize"in s?s.pluralize:typeof pluralize!="undefined"?pluralize:undefined),n.join("")};return e}),define("app/jade",["libjs-jade-runtime","app/utils","jade!app/text/postbox","jade!app/text/comment","jade!app/text/comment-loader","jade!app/text/continue-thread"],function(runtime,utils,tt_postbox,tt_comment,tt_comment_loader,tt_continue_thread){"use strict";var globals={},templates={},load=function(name,js){templates[name]=function(jade){var fn;return eval("fn = "+js),fn}(runtime)},set=function(e,t){globals[e]=t};return load("postbox",tt_postbox),load("comment",tt_comment),load("comment-loader",tt_comment_loader),load("continue-thread",tt_continue_thread),set("bool",function(e){return e?!0:!1}),set("humanize",function(e){return typeof e!="object"&&(e=new Date(parseInt(e,10)*1e3)),e.toString()}),set("datetime",function(e){return typeof e!="object"&&(e=new Date(parseInt(e,10)*1e3)),[e.getUTCFullYear(),utils.pad(e.getUTCMonth(),2),utils.pad(e.getUTCDay(),2)].join("-")+"T"+[utils.pad(e.getUTCHours(),2),utils.pad(e.getUTCMinutes(),2),utils.pad(e.getUTCSeconds(),2)].join(":")+"Z"}),{set:set,render:function(e,t){var n,r=templates[e];if(!r)throw new Error("Template not found: '"+e+"'");t=t||{};var i=[];for(var s in t)t.hasOwnProperty(s)&&!globals.hasOwnProperty(s)&&(i.push(s),globals[s]=t[s]);n=templates[e](globals);for(var o=0;o<i.length;o++)delete globals[i[o]];return n}}}),define("app/lib/editor",["app/dom","app/i18n"],function(e,t){"use strict";return function(e){return e.setAttribute("contentEditable",!0),e.on("focus",function(){e.classList.contains("placeholder")&&(e.innerHTML="",e.classList.remove("placeholder"))}),e.on("blur",function(){e.textContent.length===0&&(e.textContent=t.translate("postbox-text"),e.classList.add("placeholder"))}),e}}),define("app/lib/identicons",["app/lib/promise","app/config"],function(e,t){"use strict";var n=5,r=function(e,t){return e.length>=t?e:(new Array(t-e.length+1)).join("0")+e},i=function(e,t,n,r,i,s){var o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("x",r+t*i),o.setAttribute("y",r+n*i),o.setAttribute("width",i),o.setAttribute("height",i),o.setAttribute("style","fill: "+s),e.appendChild(o)},s=function(s,o,u){var a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("version","1.1"),a.setAttribute("viewBox","0 0 "+u+" "+u),a.setAttribute("preserveAspectRatio","xMinYMin meet"),a.setAttribute("shape-rendering","crispEdges"),i(a,0,0,0,u+2*o,t["avatar-bg"]),typeof s===null?a:(e.when(s,function(e){var s=r((parseInt(e,16)%Math.pow(2,18)).toString(2),18),u=0;a.setAttribute("data-hash",e);var f=parseInt(s.substring(s.length-3,s.length),2),l=t["avatar-fg"][f%t["avatar-fg"].length];for(var c=0;c<Math.ceil(n/2);c++)for(var h=0;h<n;h++)s.charAt(u)==="1"&&(i(a,c,h,o,8,l),c<Math.floor(n/2)&&i(a,n-1-c,h,o,8,l)),u++}),a)},o=function(e,t){var n=parseInt([0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,0].join(""),2).toString(16),r=s(n,e,t);return r.setAttribute("className","blank"),r};return{generate:s,blank:o}}),define("app/lib",["require","app/lib/editor","app/lib/identicons"],function(e){return{editorify:e("app/lib/editor"),identicons:e("app/lib/identicons")}}),define("app/isso",["app/dom","app/utils","app/config","app/api","app/jade","app/i18n","app/lib","app/globals"],function(e,t,n,r,i,s,o,u){"use strict";var a=new CustomEvent("done-rendering"),f=function(s){var u=t.localStorageImpl,f=e.htmlify(i.render("postbox",{author:JSON.parse(u.getItem("author")),email:JSON.parse(u.getItem("email")),website:JSON.parse(u.getItem("website"))}));return f.onsuccess=function(){},f.validate=function(){return t.text(e(".textarea",this).innerHTML).length<3||e(".textarea",this).classList.contains("placeholder")?(e(".textarea",this).focus(),!1):n["require-email"]&&e("[name='email']",this).value.length<=0?(e("[name='email']",this).focus(),!1):!0},n["require-email"]&&(e("[name='email']",f).placeholder=e("[name='email']",f).placeholder.replace(/ \(.*\)/,"")),e("[type=submit]",f).on("click",function(){if(!f.validate())return;var n=e("[name=author]",f).value||null,i=e("[name=email]",f).value||null,o=e("[name=website]",f).value||null;u.setItem("author",JSON.stringify(n)),u.setItem("email",JSON.stringify(i)),u.setItem("website",JSON.stringify(o)),r.create(e("#isso-thread").getAttribute("data-isso-id"),{author:n,email:i,website:o,text:t.text(e(".textarea",f).innerHTML),parent:s||null}).then(function(t){e(".textarea",f).innerHTML="",e(".textarea",f).blur(),h(t,!0),document.dispatchEvent(a),s!==null&&f.onsuccess()})}),o.editorify(e(".textarea",f)),f},l=function(t,s){var o;t.id===null?(o=e("#isso-root"),t.name="null"):(o=e("#isso-"+t.id+" > .text-wrapper > .isso-follow-up"),t.name=t.id);var u=e.htmlify(i.render("comment-loader",{comment:t}));o.append(u),e("a.load_hidden",u).on("click",function(){u.remove(),r.fetch(e("#isso-thread").getAttribute("data-isso-id"),n["reveal-on-click"],n["max-comments-nested"],t.id,s).then(function(e){if(e.total_replies===0)return;var t=0;e.replies.forEach(function(e){h(e,!1),e.created>t&&(t=e.created)}),e.hidden_replies>0&&l(e,t),document.dispatchEvent(a)},function(e){console.log(e)})})},c=function(t){var s=e("#isso-"+t.id+" > .text-wrapper > .isso-follow-up");t.name=t.id;var o=e.htmlify(i.render("continue-thread",{comment:t}));s.append(o),e("a.continue-thread",o).on("click",function(){o.remove(),r.fetch(e("#isso-thread").getAttribute("data-isso-id"),n["reveal-on-click"],n["max-comments-nested"],t.id).then(function(e){if(e.total_replies===0)return;var t=0;e.replies.forEach(function(e){h(e,!1),e.created>t&&(t=e.created)}),e.hidden_replies>0&&l(e,t),document.dispatchEvent(a)},function(e){console.log(e)})})},h=function(p,d){var v=e.htmlify(i.render("comment",{comment:p}));v.get_level=function(){var e=this.parentNode,t=0;while(e!=null)e.classList&&e.classList.contains("isso-comment")&&t++,e=e.parentNode;return t};var m=function(){e(".permalink > time",v).textContent=t.ago(u.offset.localTime(),new Date(parseInt(p.created,10)*1e3)),setTimeout(m,6e4)};m(),n.avatar&&e("div.avatar > svg",v).replace(o.identicons.generate(p.hash,4,48));var g;p.parent===null?g=e("#isso-root"):g=e("#isso-"+p.parent+" > .text-wrapper > .isso-follow-up"),g.append(v),d&&v.scrollIntoView();var y=e("#isso-"+p.id+" > .text-wrapper > .isso-comment-footer"),b=e("#isso-"+p.id+" > .text-wrapper > .isso-comment-header"),w=e("#isso-"+p.id+" > .text-wrapper > .text"),E=null;n["nesting-level"]>=1&&e("a.reply",y).toggle("click",function(t){n["nesting-level"]!=="inf"&&v.get_level()>=n["nesting-level"]?E=y.insertAfter(new f(p.parent)):E=y.insertAfter(new f(p.id)),E.onsuccess=function(){t.next()},e(".textarea",E).focus(),e("a.reply",y).textContent=s.translate("comment-close")},function(){E.remove(),e("a.reply",y).textContent=s.translate("comment-reply")});if(n.vote){var S=function(t){var n=e("span.votes",y);n===null?t!==0&&y.prepend(e.new("span.votes",t)):t===0?n.remove():n.textContent=t};e("a.upvote",y).on("click",function(){r.like(p.id).then(function(e){S(e.likes-e.dislikes)})}),e("a.downvote",y).on("click",function(){r.dislike(p.id).then(function(e){S(e.likes-e.dislikes)})})}n.locked||(e("a.reply",y).toggle("click",function(t){E=y.insertAfter(new f(p.parent===null?p.id:p.parent)),E.onsuccess=function(){t.next()},e(".textarea",E).focus(),e("a.reply",y).textContent=s.translate("comment-close")},function(){E.remove(),e("a.reply",y).textContent=s.translate("comment-reply")}),e("a.edit",y).toggle("click",function(i){var u=e("a.edit",y),a=n.avatar?e(".avatar",v,!1)[0]:null;u.textContent=s.translate("comment-save"),u.insertAfter(e.new("a.cancel",s.translate("comment-cancel"))).on("click",function(){i.canceled=!0,i.next()}),i.canceled=!1,r.view(p.id,1).then(function(n){var r=o.editorify(e.new("div.textarea"));r.innerHTML=t.detext(n.text),r.focus(),w.classList.remove("text"),w.classList.add("textarea-wrapper"),w.textContent="",w.append(r)}),a!==null&&a.hide()},function(i){var o=e(".textarea",w),u=n.avatar?e(".avatar",v,!1)[0]:null;if(!i.canceled&&o!==null){if(t.text(o.innerHTML).length<3){o.focus(),i.wait();return}r.modify(p.id,{text:t.text(o.innerHTML)}).then(function(e){w.innerHTML=e.text,p.text=e.text})}else w.innerHTML=p.text;w.classList.remove("textarea-wrapper"),w.classList.add("text"),u!==null&&u.show(),e("a.cancel",y).remove(),e("a.edit",y).textContent=s.translate("comment-edit")}),e("a.delete",y).toggle("click",function(t){var n=e("a.delete",y),r=!t.state;n.textContent=s.translate("comment-confirm"),n.on("mouseout",function(){n.textContent=s.translate("comment-delete"),t.state=r,n.onmouseout=null})},function(){var t=e("a.delete",y);r.remove(p.id).then(function(n){n?v.remove():(e("span.note",b).textContent=s.translate("comment-deleted"),w.innerHTML="<p>&nbsp;</p>",e("a.edit",y).remove(),e("a.delete",y).remove()),t.textContent=s.translate("comment-delete")})}));var x=function(n){t.cookie("isso-"+p.id)?setTimeout(function(){x(n)},15e3):e(n,y)!==null&&e(n,y).remove()};x("a.edit"),x("a.delete");var T=function(e){t.cookie("isso-"+p.id)?setTimeout(function(){T(e)},15e3):y.append(e)};n["nesting-level"]>=1&&n["reply-to-self"]&&t.cookie("isso-"+p.id)&&T(e("a.reply",y).detach());if(p.hasOwnProperty("replies")){var N=0;p.replies.forEach(function(e){h(e,!1),e.created>N&&(N=e.created)}),p.hidden_replies>0&&l(p,N)}p.deeper_replies>0&&c(p),document.dispatchEvent(a)};return{done_rendering:a,insert:h,insert_loader:l,insert_continue_thread:c,Postbox:f}}),define("app/count",["app/api","app/dom","app/i18n"],function(e,t,n){return function(){var r={};t.each("a",function(e){if(!e.href.match(/#isso-thread$/))return;var t=e.getAttribute("data-isso-id")||e.href.match(/^(.+)#isso-thread$/)[1].replace(/^.*\/\/[^\/]+/,"");t in r?r[t].push(e):r[t]=[e]});var i=Object.keys(r);e.count(i).then(function(e){for(var t in r)if(r.hasOwnProperty(t)){var s=i.indexOf(t);for(var o=0;o<r[t].length;o++)r[t][o].textContent=n.pluralize("num-comments",e[s])}})}}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!app/../../css/isso.css",[],function(){return"#isso-thread * {\n    -webkit-box-sizing: border-box;\n    -moz-box-sizing: border-box;\n    box-sizing: border-box;\n}\n#isso-thread a {\n    text-decoration: none;\n}\n\n#isso-thread {\n    padding: 0;\n    margin: 0;\n}\n#isso-thread > h4 {\n    color: #555;\n    font-weight: bold;\n}\n#isso-thread .textarea {\n    min-height: 58px;\n    outline: 0;\n}\n#isso-thread .textarea.placeholder {\n    color: #AAA;\n}\n\n.isso-comment {\n    max-width: 68em;\n    padding-top: 0.95em;\n    margin: 0.95em auto;\n}\n.isso-comment:not(:first-of-type),\n.isso-follow-up .isso-comment {\n    border-top: 1px solid rgba(0, 0, 0, 0.1);\n}\n.isso-comment > div.avatar,\n.isso-postbox > .avatar {\n    display: block;\n    float: left;\n    width: 7%;\n    margin: 3px 15px 0 0;\n}\n.isso-postbox > .avatar {\n    float: left;\n    margin: 5px 10px 0 5px;\n    width: 48px;\n    height: 48px;\n    overflow: hidden;\n}\n.isso-comment > div.avatar > svg,\n.isso-postbox > .avatar > svg {\n    max-width: 48px;\n    max-height: 48px;\n    border: 1px solid rgba(0, 0, 0, 0.2);\n    border-radius: 3px;\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.isso-comment > div.text-wrapper {\n    display: block;\n}\n.isso-comment .isso-follow-up {\n    padding-left: calc(7% + 20px);\n}\n.isso-comment > div.text-wrapper > .isso-comment-header, .isso-comment > div.text-wrapper > .isso-comment-footer {\n    font-size: 0.95em;\n}\n.isso-comment > div.text-wrapper > .isso-comment-header {\n    font-size: 0.85em;\n}\n.isso-comment > div.text-wrapper > .isso-comment-header .spacer {\n    padding: 0 6px;\n}\n.isso-comment > div.text-wrapper > .isso-comment-header .spacer,\n.isso-comment > div.text-wrapper > .isso-comment-header a.permalink,\n.isso-comment > div.text-wrapper > .isso-comment-header .note,\n.isso-comment > div.text-wrapper > .isso-comment-header a.parent {\n    color: gray !important;\n    font-weight: normal;\n    text-shadow: none !important;\n}\n.isso-comment > div.text-wrapper > .isso-comment-header .spacer:hover,\n.isso-comment > div.text-wrapper > .isso-comment-header a.permalink:hover,\n.isso-comment > div.text-wrapper > .isso-comment-header .note:hover,\n.isso-comment > div.text-wrapper > .isso-comment-header a.parent:hover {\n    color: #606060 !important;\n}\n.isso-comment > div.text-wrapper > .isso-comment-header .note {\n    float: right;\n}\n.isso-comment > div.text-wrapper > .isso-comment-header .author {\n    font-weight: bold;\n    color: #555;\n}\n.isso-comment > div.text-wrapper > .textarea-wrapper .textarea {\n    margin-top: 0.2em;\n}\n.isso-comment > div.text-wrapper > div.text p {\n    margin-top: 0.2em;\n}\n.isso-comment > div.text-wrapper > div.text p:last-child {\n    margin-bottom: 0.2em;\n}\n.isso-comment > div.text-wrapper > div.text h1,\n.isso-comment > div.text-wrapper > div.text h2,\n.isso-comment > div.text-wrapper > div.text h3,\n.isso-comment > div.text-wrapper > div.text h4,\n.isso-comment > div.text-wrapper > div.text h5,\n.isso-comment > div.text-wrapper > div.text h6 {\n    font-size: 130%;\n    font-weight: bold;\n}\n.isso-comment > div.text-wrapper > div.textarea-wrapper .textarea {\n    width: 100%;\n    border: 1px solid #f0f0f0;\n    border-radius: 2px;\n    box-shadow: 0 0 2px #888;\n}\n.isso-comment > div.text-wrapper > .isso-comment-footer {\n    font-size: 0.80em;\n    color: gray !important;\n    clear: left;\n}\n.isso-comment > div.text-wrapper > .isso-comment-footer a {\n    font-weight: bold;\n    text-decoration: none;\n}\n.isso-comment > div.text-wrapper > .isso-comment-footer a:hover {\n    color: #111111 !important;\n    text-shadow: #aaaaaa 0 0 1px !important;\n}\n.isso-comment > div.text-wrapper > .isso-comment-footer > a {\n    position: relative;\n    top: .2em;\n}\n.isso-comment > div.text-wrapper > .isso-comment-footer > a + a {\n    padding-left: 1em;\n}\n.isso-comment > div.text-wrapper > .isso-comment-footer .votes {\n    color: gray;\n}\n.isso-comment > div.text-wrapper > .isso-comment-footer .upvote svg,\n.isso-comment > div.text-wrapper > .isso-comment-footer .downvote svg {\n    position: relative;\n    top: .2em;\n}\n.isso-comment .isso-postbox {\n    margin-top: 0.8em;\n}\n\n.isso-postbox {\n    max-width: 68em;\n    margin: 0 auto 2em;\n}\n.isso-postbox > .form-wrapper {\n    display: block;\n    padding: 0;\n}\n.isso-postbox > .form-wrapper > .auth-section,\n.isso-postbox > .form-wrapper > .auth-section .post-action {\n    display: block;\n}\n.isso-postbox > .form-wrapper .textarea {\n    margin: 0 0 .3em;\n    padding: .4em .8em;\n    border-radius: 3px;\n    background-color: #fff;\n    border: 1px solid rgba(0, 0, 0, 0.2);\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n#isso-thread .textarea:focus,\n#isso-thread input:focus {\n    border-color: rgba(0, 0, 0, 0.8);\n}\n.isso-postbox > .form-wrapper > .auth-section .input-wrapper {\n    display: inline-block;\n    position: relative;\n    max-width: 25%;\n    margin: 0;\n}\n.isso-postbox > .form-wrapper > .auth-section .input-wrapper input {\n    padding: .3em 10px;\n    max-width: 100%;\n    border-radius: 3px;\n    background-color: #fff;\n    line-height: 1.4em;\n    border: 1px solid rgba(0, 0, 0, 0.2);\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.isso-postbox > .form-wrapper > .auth-section .post-action {\n    display: inline-block;\n    float: right;\n    margin: 0;\n}\n.isso-postbox > .form-wrapper > .auth-section .post-action > input {\n    padding: calc(.3em - 1px);\n    border-radius: 2px;\n    border: 1px solid #CCC;\n    background-color: #DDD;\n    cursor: pointer;\n    outline: 0;\n    line-height: 1.4em;\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.isso-postbox > .form-wrapper > .auth-section .post-action > input:hover {\n    background-color: #CCC;\n}\n.isso-postbox > .form-wrapper > .auth-section .post-action > input:active {\n    background-color: #BBB;\n}\n@media screen and (max-width:600px) {\n    .isso-postbox > .form-wrapper > .auth-section .input-wrapper {\n        display: block;\n        max-width: 100%;\n        margin: 0 0 .3em;\n    }\n    .isso-postbox > .form-wrapper > .auth-section .input-wrapper input {\n        width: 100%;\n    }\n    .isso-postbox > .form-wrapper > .auth-section .post-action {\n        display: block;\n        float: none;\n        text-align: right;\n    }\n}\n"}),define("app/text/css",["text!../../../css/isso.css"],function(e){return{inline:e}}),define("text!app/text/arrow-down.svg",[],function(){return'<!-- Generator: IcoMoon.io --><svg width="16" height="16" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="gray">\n  <g>\n    <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z">\n    </path>\n  </g>\n</svg>\n'}),define("text!app/text/arrow-up.svg",[],function(){return'<!-- Generator: IcoMoon.io --><svg width="16" height="16" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="gray">\n  <g>\n    <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z">\n    </path>\n  </g>\n</svg>\n'}),define("app/text/svg",["text!./arrow-down.svg","text!./arrow-up.svg"],function(e,t){return{"arrow-down":e,"arrow-up":t}}),require(["app/lib/ready","app/config","app/i18n","app/api","app/isso","app/count","app/dom","app/text/css","app/text/svg","app/jade"],function(e,t,n,r,i,s,o,u,a,f){"use strict";f.set("conf",t),f.set("i18n",n.translate),f.set("pluralize",n.pluralize),f.set("svg",a),e(function(){if(t.css){var e=o.new("style");e.type="text/css",e.textContent=u.inline,o("head").append(e)}s();if(o("#isso-thread")===null)return console.log("abort, #isso-thread is missing");o("#isso-thread").append(o.new("h4")),r.fetch(o("#isso-thread").getAttribute("data-isso-id"),t["max-comments-top"],t["max-comments-nested"]).then(function(e){if(e.total_replies===0){o("#isso-thread > h4").textContent=n.translate("no-comments");return}e.locked==1&&(t.locked=!0),t.locked||o("#isso-thread").append(new i.Postbox(null)),o("#isso-thread").append('<div id="isso-root"></div>');var r=0,s;e.total_replies_in_thread?s=e.total_replies_in_thread:(s=e.total_replies,e.replies.forEach(function(e){s+=e.total_replies})),e.replies.forEach(function(e){i.insert(e,!1),e.created>r&&(r=e.created)}),o("#isso-thread > h4").textContent=n.pluralize("num-comments",s),e.hidden_replies>0&&i.insert_loader(e,r),window.location.hash.length>0&&o(window.location.hash).scrollIntoView(),document.dispatchEvent(i.done_rendering)},function(e){console.log(e)})})}),define("embed",function(){})})();